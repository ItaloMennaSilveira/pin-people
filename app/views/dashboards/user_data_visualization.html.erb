<h1>Visualização de Dados - Nível Colaborador</h1>

<%= form_with url: dashboards_user_data_visualization_path, method: :get, local: true do %>
  <div>
    <label for="company_id">Selecionar Empresa:</label>
    <%= select_tag :company_id, options_from_collection_for_select(@companies, :id, :name, @company_id), include_blank: "Todas", onchange: "this.form.submit()" %>
  </div>
<% end %>

<p>
  Nesta seção, apresentamos os dados dos colaboradores de forma anonimizada. As informações exibidas permitem analisar perfis individuais em comparação com a média da área correspondente.
</p>

<% if @users.any? %>
  <table id="users-table" style="width: 100%; border-collapse: collapse; margin-top: 20px;">
    <thead>
      <tr>
        <th style="border-bottom: 1px solid #ccc; text-align: center;">Tempo de Empresa</th>
        <th style="border-bottom: 1px solid #ccc; text-align: center;">Função</th>
        <th style="border-bottom: 1px solid #ccc; text-align: center;">Gênero</th>
        <th style="border-bottom: 1px solid #ccc; text-align: center;">Geração</th>
        <th style="border-bottom: 1px solid #ccc; text-align: center;">eNPS Médio da Área</th>
        <th style="border-bottom: 1px solid #ccc; text-align: center;">Satisfação Média da Área</th>
      </tr>
    </thead>
    <tbody>
      <% @users.each do |user| %>
        <tr style="border-bottom: 1px solid #ddd;">
          <td style="text-align: center;"><%= user[:company_tenure] %></td>
          <td style="text-align: center;"><%= user[:function] %></td>
          <td style="text-align: center;"><%= user[:genre] %></td>
          <td style="text-align: center;"><%= user[:generation] %></td>
          <td style="text-align: center;"><%= user[:area_enps_avg].present? ? number_with_precision(user[:area_enps_avg], precision: 2) : 'N/A' %></td>
          <td style="text-align: center;"><%= user[:area_satisfaction_avg].present? ? number_with_precision(user[:area_satisfaction_avg], precision: 2) : 'N/A' %></td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <div class="pagination" style="margin-top: 20px; text-align: center;" id="users-table-container">
    <% total_pages = (@total_users_count / 50.0).ceil %>
    <% if total_pages > 1 %>
      <% (1..total_pages).each do |page| %>
        <%= link_to page, dashboards_user_data_visualization_path(company_id: @company_id, page: page) + "#users-table-container", class: "pagination-link", style: "margin: 0 5px; text-decoration: underline;" %>
      <% end %>
    <% end %>
  </div>
<% else %>
  <p>Nenhum colaborador encontrado para a empresa selecionada.</p>
<% end %>
